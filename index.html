<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8" />
  <title>Goal Setting – Modello +STIMA</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 min-h-screen">
  <div class="max-w-5xl mx-auto p-6 space-y-6">
    <h1 class="text-3xl font-bold text-center mb-2">
      Goal Setting – Modello +STIMA
    </h1>
    <p class="text-center text-sm text-gray-700">
      Compila i campi: il sistema genera automaticamente obiettivi in forma positiva secondo il modello +STIMA.
    </p>

    <!-- FORM DATI -->
    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
      <div class="bg-white shadow rounded-2xl p-5 space-y-4">
        <h2 class="text-xl font-semibold">Dati del contesto</h2>

        <!-- Ordine scolastico -->
        <div class="space-y-1">
          <label class="text-sm font-medium">Ordine e grado scolastico</label>
          <select id="ordineSelect" class="w-full p-3 rounded-xl border text-sm">
            <option value="">— Seleziona —</option>
            <option value="infanzia">Scuola dell’infanzia</option>
            <option value="primaria">Scuola primaria</option>
            <option value="sec1">Scuola secondaria di I grado (medie)</option>
            <option value="sec2">Scuola secondaria di II grado (superiori)</option>
            <option value="altro">Altro contesto educativo</option>
          </select>
          <input
            id="ordineNote"
            class="w-full p-2 rounded-xl border text-xs"
            placeholder="Classe / sezione / note (es. 3ªA, piccolo gruppo...)"
          />
        </div>

        <!-- Materia -->
        <input
          id="materia"
          class="w-full p-3 rounded-xl border"
          placeholder="Materia / ambito (es. Italiano, Matematica, Comportamento...)"
        />

        <!-- Tipologia di bisogno -->
        <div class="space-y-1">
          <label class="text-sm font-medium">Tipologia di bisogno</label>
          <select id="tipologiaBisogno" class="w-full p-3 rounded-xl border text-sm">
            <option value="">— Seleziona —</option>
            <option value="lettura_scrittura">Lettura / scrittura</option>
            <option value="matematica_calcolo">Matematica / calcolo</option>
            <option value="attenzione_concentrazione">Attenzione / concentrazione</option>
            <option value="comportamento_relazione">Comportamento / relazione</option>
            <option value="comprensione_linguaggio">Comprensione / linguaggio</option>
            <option value="organizzazione_metodo">Organizzazione / metodo di studio</option>
            <option value="generico">Altro / generale</option>
          </select>
        </div>

        <!-- Punti di forza -->
        <div class="space-y-1">
          <label class="text-sm font-medium">Punti di forza</label>
          <select id="forzaSelect" class="w-full p-3 rounded-xl border text-sm">
            <option value="">— Seleziona un punto di forza —</option>
            <option value="buona motivazione">Buona motivazione</option>
            <option value="curiosità per l’apprendimento">Curiosità per l’apprendimento</option>
            <option value="buone abilità sociali">Buone abilità sociali</option>
            <option value="buona comprensione orale">Buona comprensione orale</option>
            <option value="creatività">Creatività</option>
            <option value="autonomia nelle routine">Autonomia nelle routine</option>
          </select>
          <textarea
            id="forzaExtra"
            class="w-full p-2 rounded-xl border text-xs min-h-[50px]"
            placeholder="Altri punti di forza (opzionale)..."
          ></textarea>
        </div>

        <!-- Punti di debolezza -->
        <div class="space-y-1">
          <label class="text-sm font-medium">Punti di debolezza / bisogni</label>
          <select id="debolezzaSelect" class="w-full p-3 rounded-xl border text-sm">
            <option value="">— Seleziona un bisogno prevalente —</option>
            <option value="lettura_ad_alta_voce">Difficoltà nella lettura ad alta voce</option>
            <option value="comprensione_testo">Difficoltà di comprensione del testo</option>
            <option value="scrittura_ortografia">Difficoltà di scrittura / ortografia</option>
            <option value="calcolo_tabelline">Difficoltà di calcolo / tabelline</option>
            <option value="attenzione_fatica">Fatica a mantenere l’attenzione</option>
            <option value="parla_troppo_forte">Tende a parlare a voce alta / interrompere</option>
            <option value="relazioni_pari">Difficoltà nelle relazioni con i pari</option>
            <option value="organizzazione_materiale">Difficoltà a organizzare materiale e compiti</option>
            <option value="altro">Altro...</option>
          </select>
          <textarea
            id="debolezzaExtra"
            class="w-full p-2 rounded-xl border text-xs min-h-[50px]"
            placeholder="Descrivi brevemente il bisogno (esempi concreti)..."
          ></textarea>
        </div>

        <button
          id="generateGoalsBtn"
          class="w-full p-3 bg-blue-600 text-white rounded-xl hover:bg-blue-700"
        >
          Genera obiettivi automatici (+STIMA)
        </button>

        <p class="text-xs text-gray-500">
          Gli obiettivi sono proposte da discutere in modo intersoggettivo tra docenti, famiglia e alunno.
        </p>
      </div>

      <!-- OBIETTIVI GENERATI -->
      <div class="bg-white shadow rounded-2xl p-5">
        <h2 class="text-xl font-semibold mb-3">Obiettivi suggeriti</h2>
        <div id="goalsContainer" class="space-y-4">
          <p class="text-gray-600" id="noGoalsMsg">
            Nessun obiettivo generato. Compila i campi e clicca “Genera obiettivi automatici”.
          </p>
        </div>
      </div>
    </div>

    <!-- ESPORTAZIONE -->
    <div class="bg-white shadow rounded-2xl p-6 space-y-3">
      <h2 class="text-xl font-semibold">Esportazione per Word / PDF</h2>
      <p class="text-sm md:text-base">
        1) Clicca su “Genera testo per Word”.<br />
        2) Copia e incolla il testo in un documento Word.<br />
        3) Da Word puoi salvare in PDF.
      </p>
      <button
        id="exportTextBtn"
        class="p-3 bg-emerald-600 text-white rounded-xl hover:bg-emerald-700"
      >
        Genera testo per Word
      </button>
      <textarea
        id="exportText"
        class="w-full mt-3 p-3 rounded-xl border min-h-[140px]"
        placeholder="Qui comparirà il testo da copiare in Word."
      ></textarea>
    </div>
  </div>

  <script>
    const goals = [];

    const ordineSelect = document.getElementById("ordineSelect");
    const ordineNoteInput = document.getElementById("ordineNote");
    const materiaInput = document.getElementById("materia");
    const tipologiaSelect = document.getElementById("tipologiaBisogno");
    const forzaSelect = document.getElementById("forzaSelect");
    const forzaExtraInput = document.getElementById("forzaExtra");
    const debolezzaSelect = document.getElementById("debolezzaSelect");
    const debolezzaExtraInput = document.getElementById("debolezzaExtra");

    const generateGoalsBtn = document.getElementById("generateGoalsBtn");
    const goalsContainer = document.getElementById("goalsContainer");
    const noGoalsMsg = document.getElementById("noGoalsMsg");
    const exportTextBtn = document.getElementById("exportTextBtn");
    const exportTextArea = document.getElementById("exportText");

    function renderGoals() {
      goalsContainer.innerHTML = "";
      if (goals.length === 0) {
        noGoalsMsg.style.display = "block";
        goalsContainer.appendChild(noGoalsMsg);
        return;
      }
      noGoalsMsg.style.display = "none";

      goals.forEach(function(g, index) {
        const card = document.createElement("div");
        card.className =
          "border rounded-xl p-4 bg-gray-50 text-sm md:text-base space-y-1";
        card.innerHTML =
          "<p class='font-semibold'>Obiettivo " +
          (index + 1) +
          ": " +
          g.titolo +
          "</p><p>" +
          g.descrizione +
          "</p>";
        goalsContainer.appendChild(card);
      });
    }

    function costruisciObiettivi(ordineCod, materia, tipologia, forza, debolezza) {
      const risultati = [];
      const materiaLabel = materia || "l’ambito di lavoro";
      var livello = "classe";
      var setting = "in classe";

      if (ordineCod === "infanzia") {
        livello = "sezione";
        setting = "nel piccolo gruppo in sezione";
      } else if (ordineCod === "primaria") {
        livello = "classe";
        setting = "in classe durante le lezioni";
      } else if (ordineCod === "sec1" || ordineCod === "sec2") {
        livello = "classe";
        setting = "durante le lezioni disciplinari";
      }

      const forzaShort = forza || "i punti di forza individuati";

      function addGoal(titolo, descrizione) {
        risultati.push({ titolo: titolo, descrizione: descrizione });
      }

      // Regole semplici per tipologia
      if (tipologia === "lettura_scrittura") {
        if (ordineCod === "infanzia") {
          addGoal(
            "Sviluppo delle competenze prelettura",
            "Entro 6 settimane, " +
              setting +
              ", l’alunno parteciperà ad attività di ascolto, ripetizione e anticipazione di brevi storie o filastrocche, riproducendo correttamente almeno 4 enunciati su 5 in 4 situazioni su 5, valorizzando " +
              forzaShort +
              "."
          );
        } else {
          addGoal(
            "Miglioramento della lettura ad alta voce",
            "Entro 6 settimane, durante le attività di " +
              materiaLabel +
              " " +
              setting +
              ", l’alunno leggerà ad alta voce brevi brani (3–5 righe) con non più di 3 errori di decodifica in almeno 4 occasioni su 5, valorizzando " +
              forzaShort +
              "."
          );
          addGoal(
            "Accuratezza nella produzione scritta",
            "Entro il termine del trimestre, nelle attività di " +
              materiaLabel +
              " " +
              setting +
              ", l’alunno produrrà testi brevi (5–8 frasi) con massimo 3 errori ortografici per testo in almeno 3 prove su 4, utilizzando schemi guida e rilettura ad alta voce."
          );
        }
      } else if (tipologia === "matematica_calcolo") {
        if (ordineCod === "infanzia") {
          addGoal(
            "Sviluppo dei prerequisiti logico-matematici",
            "Entro 8 settimane, " +
              setting +
              ", l’alunno riconoscerà e conterà correttamente insiemi di oggetti fino a 5/10 elementi in almeno 4 situazioni su 5, attraverso giochi di conteggio e materiali concreti."
          );
        } else {
          addGoal(
            "Automatizzazione del calcolo di base",
            "Entro 8 settimane, durante le lezioni di " +
              materiaLabel +
              " in " +
              livello +
              ", l’alunno risolverà correttamente almeno 8 operazioni su 10 del tipo indicato (es. addizioni e sottrazioni entro il 100) in 4 verifiche consecutive, con schede strutturate e tempo aggiuntivo se necessario."
          );
        }
      } else if (tipologia === "attenzione_concentrazione") {
        if (ordineCod === "infanzia") {
          addGoal(
            "Mantenimento dell’attenzione nelle routine",
            "Entro 6 settimane, durante circle time e attività guidate " +
              setting +
              ", l’alunno rimarrà seduto e partecipe per almeno 5–7 minuti consecutivi, con al massimo un richiamo leggero dell’adulto, in 4 routine su 5, supportato da agenda visiva e segnali condivisi."
          );
        } else {
          addGoal(
            "Mantenimento dell’attenzione sul compito",
            "Entro 6 settimane, " +
              setting +
              ", l’alunno manterrà l’attenzione sul compito per almeno 10 minuti consecutivi, con al massimo un richiamo leggero dell’adulto, in 4 lezioni su 5, utilizzando timer visivi e indicazioni passo-passo."
          );
        }
      } else if (tipologia === "comportamento_relazione") {
        if (ordineCod === "infanzia") {
          addGoal(
            "Regolazione del comportamento nel gruppo",
            "Entro 8 settimane, durante i momenti di gioco strutturato e circle time " +
              setting +
              ", l’alunno rispetterà i turni di parola, utilizzerà un tono di voce adeguato e condividerà almeno un gioco o materiale con i pari in 4 attività su 5, con il supporto di regole visive e rinforzi positivi."
          );
        } else {
          addGoal(
            "Regolazione del comportamento in gruppo",
            "Entro 8 settimane, durante i lavori di gruppo in " +
              livello +
              ", l’alunno interverrà rispettando il turno di parola e mantenendo un tono di voce adeguato in almeno 4 attività su 5, con regole condivise e rinforzi positivi concordati nel team educativo."
          );
        }
      } else if (tipologia === "comprensione_linguaggio") {
        if (ordineCod === "infanzia") {
          addGoal(
            "Comprensione di storie e istruzioni semplici",
            "Entro il termine del trimestre, durante la lettura o narrazione di brevi storie " +
              setting +
              ", l’alunno risponderà correttamente ad almeno 3 domande su 4 (chi? cosa fa? dove?) in 4 situazioni su 5, con supporto di immagini o oggetti."
          );
        } else {
          addGoal(
            "Comprensione del testo scritto",
            "Entro il termine del quadrimestre, in " +
              materiaLabel +
              ", l’alunno risponderà correttamente ad almeno 4 domande su 5 relative a un breve testo narrativo o informativo, con o senza audio-lettura, utilizzando mappe o immagini di supporto."
          );
        }
      } else if (tipologia === "organizzazione_metodo") {
        if (ordineCod === "infanzia") {
          addGoal(
            "Organizzazione nelle routine di sezione",
            "Entro 6 settimane, all’inizio e alla fine delle attività " +
              setting +
              ", l’alunno riporrà il proprio materiale (grembiule, zainetto, giochi) nel posto assegnato in almeno 4 giorni su 5, con etichette visive e modellamento adulto."
          );
        } else {
          addGoal(
            "Organizzazione del materiale e del lavoro",
            "Entro 6 settimane, all’inizio delle lezioni in " +
              livello +
              ", l’alunno preparerà autonomamente il materiale necessario (quaderni, libro, astuccio) e compilerà una breve lista di cose da fare in almeno 4 giorni su 5, utilizzando una check-list visiva."
          );
        }
      } else {
        // obiettivo generico se non è stata selezionata una tipologia chiara
        addGoal(
          "Obiettivo di autonomia progressiva",
          "Entro 6–8 settimane, nelle attività di " +
            materiaLabel +
            " in " +
            livello +
            ", l’alunno porterà a termine il compito assegnato con massimo un supporto individualizzato dell’adulto, in almeno 3 situazioni su 4, valorizzando " +
            forzaShort +
            " e utilizzando strategie condivise (scomposizione in passi, agenda visiva, tempi di pausa concordati)."
        );
      }

      return risultati;
    }

    generateGoalsBtn.addEventListener("click", function() {
      const ordineCod = ordineSelect.value;
      const ordineNote = ordineNoteInput.value.trim();
      const materia = materiaInput.value.trim();
      const tipologia = tipologiaSelect.value;

      var forza = "";
      if (forzaSelect.value) {
        const fOpt = forzaSelect.options[forzaSelect.selectedIndex].text;
        forza = fOpt;
      }
      const forzaExtra = forzaExtraInput.value.trim();
      if (forzaExtra) {
        forza = forza ? forza + "; " + forzaExtra : forzaExtra;
      }

      var debolezza = "";
      if (debolezzaSelect.value) {
        const dOpt = debolezzaSelect.options[debolezzaSelect.selectedIndex].text;
        debolezza = dOpt;
      }
      const debolezzaExtra = debolezzaExtraInput.value.trim();
      if (debolezzaExtra) {
        debolezza = debolezza ? debolezza + "; " + debolezzaExtra : debolezzaExtra;
      }

      if (!ordineCod) {
        alert("Seleziona l’ordine scolastico.");
        return;
      }
      if (!tipologia) {
        alert("Seleziona la tipologia di bisogno.");
        return;
      }

      const obiettivi = costruisciObiettivi(
        ordineCod,
        materia,
        tipologia,
        forza,
        debolezza
      );

      goals.length = 0;
      obiettivi.forEach(function(g) {
        goals.push(g);
      });
      renderGoals();
    });

    exportTextBtn.addEventListener("click", function() {
      if (goals.length === 0) {
        exportTextArea.value =
          "Nessun obiettivo generato. Compila i campi e clicca su “Genera obiettivi automatici (+STIMA)”.";
        return;
      }

      const ordineLabel = ordineSelect.value
        ? ordineSelect.options[ordineSelect.selectedIndex].text
        : "-";
      const ordineNote = ordineNoteInput.value || "";
      const materia = materiaInput.value || "-";
      const tipologia =
        tipologiaSelect.value
          ? tipologiaSelect.options[tipologiaSelect.selectedIndex].text
          : "-";

      var forza = "";
      if (forzaSelect.value) {
        forza = forzaSelect.options[forzaSelect.selectedIndex].text;
      }
      const forzaExtra = forzaExtraInput.value.trim();
      if (forzaExtra) {
        forza = forza ? forza + "; " + forzaExtra : forzaExtra;
      }
      if (!forza) forza = "-";

      var debolezza = "";
      if (debolezzaSelect.value) {
        debolezza = debolezzaSelect.options[debolezzaSelect.selectedIndex].text;
      }
      const debolezzaExtra = debolezzaExtraInput.value.trim();
      if (debolezzaExtra) {
        debolezza = debolezza ? debolezza + "; " + debolezzaExtra : debolezzaExtra;
      }
      if (!debolezza) debolezza = "-";

      var testo = "";
      testo += "CONTESTO\n";
      testo += "Ordine e grado scolastico: " + ordineLabel;
      if (ordineNote) testo += " – " + ordineNote;
      testo += "\n";
      testo += "Materia / ambito: " + materia + "\n";
      testo += "Tipologia di bisogno: " + tipologia + "\n\n";

      testo += "PUNTI DI FORZA\n" + forza + "\n\n";
      testo += "PUNTI DI DEBOLEZZA / BISOGNI\n" + debolezza + "\n\n";
      testo += "OBIETTIVI FORMULATI SECONDO IL MODELLO +STIMA\n\n";

      goals.forEach(function(g, i) {
        testo += "OBIETTIVO " + (i + 1) + ": " + g.titolo + "\n";
        testo += g.descrizione + "\n";
        testo += "----------------------------------------\n\n";
      });

      testo += "SPAZIO PER LA CONDIVISIONE INTERSOGGETTIVA\n";
      testo += "Docente/i coinvolti: __________________________\n";
      testo += "Famiglia (genitore/i o tutore/i): _____________\n";
      testo += "Alunno/a: ____________________________________\n";
      testo += "Data: ________________________________________\n";

      exportTextArea.value = testo;
    });

    // render iniziale
    renderGoals();
  </script>
</body>
</html>
